# Story 1.10: Implement Auth Flow

**Epic:** E1 - Foundation  
**Status:** ready-for-dev  
**Priority:** P0  
**Dependencies:** 1.5, 1.6, 1.7, 1.8, 1.9  
**Blocks:** E2, E3, E4

## Story

As a user,
I want a complete auth flow with session management,
so that I stay logged in and my profile is auto-created on first login.

## Acceptance Criteria

1. **Given** I complete OAuth with any provider
   **When** the callback is processed
   **Then** a profile record is created in the profiles table
   **And** my name, email, avatar are populated from OAuth data

2. **Given** I am authenticated
   **When** I refresh the page
   **Then** my session persists
   **And** I remain logged in

3. **Given** I am logged in
   **When** I click logout
   **Then** my session is cleared
   **And** I am redirected to the login page

4. **Given** I am not logged in
   **When** I try to access protected routes
   **Then** I am redirected to the login page

## Tasks / Subtasks

- [ ] Task 1: Create auth callback route (AC: #1)
  - [ ] Create `src/app/auth/callback/route.ts`
  - [ ] Handle OAuth code exchange
  - [ ] Redirect to onboarding or dashboard

- [ ] Task 2: Set up middleware for session (AC: #2, #4)
  - [ ] Create `src/middleware.ts`
  - [ ] Refresh session on each request
  - [ ] Protect routes that require auth

- [ ] Task 3: Create login page (AC: #1)
  - [ ] Create `src/app/login/page.tsx`
  - [ ] Add OAuth buttons for all 5 providers
  - [ ] Style with shadcn components

- [ ] Task 4: Implement logout (AC: #3)
  - [ ] Create logout button in header
  - [ ] Call supabase.auth.signOut()
  - [ ] Redirect to login page

- [ ] Task 5: Verify profile auto-creation (AC: #1)
  - [ ] Test that DB trigger creates profile
  - [ ] Verify name, email, avatar populated

## Dev Notes

- Profile auto-creation handled by DB trigger `handle_new_user`
- Use Supabase SSR package for server-side auth
- Middleware refreshes session to prevent expiry

### Project Structure Notes

```
src/
├── app/
│   ├── auth/
│   │   └── callback/
│   │       └── route.ts
│   ├── login/
│   │   └── page.tsx
│   └── (protected)/
│       └── ... (routes requiring auth)
├── middleware.ts
```

### References

- [Source: planning-artifacts/architecture.md#Auth]
- Supabase Auth Helpers documentation

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
