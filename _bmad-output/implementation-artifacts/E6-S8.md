# Story 6.8: Implement Acceptance Notification Emails

**Epic:** E6 - Notifications  
**Status:** ready-for-dev  
**Priority:** P1  
**Dependencies:** E6-S5 (Email Notifications), E5-S7 (Apply/Accept Flow)  
**Blocks:** None

## Story

As an applicant,
I want to receive an email when my application is accepted,
so that I can start collaborating with the team immediately.

## Acceptance Criteria

1. **Given** a project creator accepts an application
   **When** the status changes to 'accepted'
   **Then** an email is sent to the applicant
   **And** email contains project title and next steps

2. **Given** the email
   **When** user receives it
   **Then** it has a celebratory subject line ("You're in! ðŸŽ‰")
   **And** it has a CTA button to start messaging
   **And** it includes the creator's name

3. **Given** email sending
   **When** it fails
   **Then** error is logged
   **And** in-app notification still works

## Tasks / Subtasks

- [ ] Task 1: Create acceptance email template (AC: #2)
  - [ ] Create `src/lib/email/templates/application-accepted.tsx`
  - [ ] Design celebratory, welcoming email
  - [ ] Include project title, creator name, CTA

- [ ] Task 2: Implement send function (AC: #1, #3)
  - [ ] Create `src/lib/email/send-acceptance-notification.ts`
  - [ ] Use Resend API
  - [ ] Handle errors gracefully

- [ ] Task 3: Trigger on accept action (AC: #1)
  - [ ] Add email trigger to accept flow in E5-S7
  - [ ] Ensure async execution

- [ ] Task 4: Test email delivery (AC: #1, #2)
  - [ ] Test with Resend test mode
  - [ ] Verify email renders correctly

## Dev Notes

### Email Template

```tsx
// src/lib/email/templates/application-accepted.tsx
import { Html, Head, Body, Container, Heading, Text, Button } from '@react-email/components';

interface AcceptedEmailProps {
  applicantName: string;
  projectTitle: string;
  creatorName: string;
  messageUrl: string;
}

export function ApplicationAcceptedEmail({ 
  applicantName, 
  projectTitle, 
  creatorName, 
  messageUrl 
}: AcceptedEmailProps) {
  return (
    <Html>
      <Head />
      <Body style={{ fontFamily: 'sans-serif' }}>
        <Container>
          <Heading>You're in! ðŸŽ‰</Heading>
          <Text>Hi {applicantName},</Text>
          <Text>
            Great news! {creatorName} accepted your application to join "{projectTitle}".
          </Text>
          <Text>
            You can now message {creatorName} directly to coordinate next steps.
          </Text>
          <Button href={messageUrl} style={{ background: '#000', color: '#fff', padding: '12px 24px' }}>
            Start Conversation
          </Button>
        </Container>
      </Body>
    </Html>
  );
}
```

### Send Function

```typescript
// src/lib/email/send-acceptance-notification.ts
import { Resend } from 'resend';
import { ApplicationAcceptedEmail } from './templates/application-accepted';

const resend = new Resend(process.env.RESEND_API_KEY);

export async function sendAcceptanceNotificationEmail(params: {
  to: string;
  applicantName: string;
  projectTitle: string;
  creatorName: string;
  projectId: string;
}) {
  try {
    await resend.emails.send({
      from: 'MeshIt <notifications@meshit.app>',
      to: params.to,
      subject: `You're in! Welcome to ${params.projectTitle} ðŸŽ‰`,
      react: ApplicationAcceptedEmail({
        applicantName: params.applicantName,
        projectTitle: params.projectTitle,
        creatorName: params.creatorName,
        messageUrl: `${process.env.NEXT_PUBLIC_APP_URL}/projects/${params.projectId}/chat`,
      }),
    });
  } catch (error) {
    console.error('Failed to send acceptance notification email:', error);
  }
}
```

### References

- [Source: planning-artifacts/prd.md#4.6 Notifications]
- [Source: planning-artifacts/architecture.md#n8n Automation]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

