# Story 5.7: Implement Apply/Accept/Decline Flow

**Epic:** E5 - Matching Engine  
**Status:** ready-for-dev  
**Priority:** P0  
**Dependencies:** E5-S3 (Match API Routes)  
**Blocks:** E6-S6 (Trigger Match Notifications)

## Story

As a user,
I want to apply to projects that match me and accept/decline applicants to my projects,
so that I can form teams through mutual interest.

## Acceptance Criteria

1. **Given** a user viewing a matched project
   **When** they click "Apply"
   **Then** match status changes to 'applied'
   **And** project creator is notified

2. **Given** a project creator viewing applicants
   **When** they click "Accept"
   **Then** match status changes to 'accepted'
   **And** applicant is notified
   **And** messaging is unlocked between them

3. **Given** a project creator viewing applicants
   **When** they click "Decline"
   **Then** match status changes to 'declined'
   **And** applicant is notified (optional)

4. **Given** a match with status 'accepted'
   **When** either party views the match
   **Then** they see collaboration options (messaging, share contacts)

5. **Given** the apply/accept actions
   **When** the database is updated
   **Then** responded_at timestamp is set

## Tasks / Subtasks

- [ ] Task 1: Implement Apply action (AC: #1)
  - [ ] Add PATCH /api/matches/[id]/apply route
  - [ ] Update match status to 'applied'
  - [ ] Set responded_at timestamp
  - [ ] Trigger notification to project creator

- [ ] Task 2: Implement Accept action (AC: #2, #5)
  - [ ] Add PATCH /api/matches/[id]/accept route
  - [ ] Update match status to 'accepted'
  - [ ] Trigger notification to applicant
  - [ ] Unlock messaging permissions

- [ ] Task 3: Implement Decline action (AC: #3, #5)
  - [ ] Add PATCH /api/matches/[id]/decline route
  - [ ] Update match status to 'declined'
  - [ ] Optionally trigger notification

- [ ] Task 4: Build action buttons UI (AC: #1, #2, #3, #4)
  - [ ] Add "Apply" button to match cards (for applicants)
  - [ ] Add "Accept" / "Decline" buttons (for project creators)
  - [ ] Show appropriate state after action
  - [ ] Add loading/disabled states during API calls

- [ ] Task 5: Handle edge cases
  - [ ] Prevent duplicate applications
  - [ ] Validate user permissions (RLS)
  - [ ] Handle already-accepted matches gracefully

## Dev Notes

### API Routes

```typescript
// PATCH /api/matches/[id]/apply
// PATCH /api/matches/[id]/accept
// PATCH /api/matches/[id]/decline

// All return updated match object
```

### Status Flow

```
pending → applied → accepted
                 → declined
```

### RLS Policies

- Only the matched user can apply
- Only the project creator can accept/decline

### References

- [Source: planning-artifacts/prd.md#4.4 Match Interaction]
- [Source: planning-artifacts/architecture.md#matches table]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

