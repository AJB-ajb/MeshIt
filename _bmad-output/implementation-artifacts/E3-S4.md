# Story 3.4: Create Profile CRUD API Routes

**Epic:** E3 - Profile Management  
**Status:** ready-for-dev  
**Priority:** P0  
**Dependencies:** E1-S4, E1-S10  
**Blocks:** 3.5, 3.6

## Story

As a frontend,
I want API endpoints for profile CRUD operations,
so that I can save and retrieve user profiles.

## Acceptance Criteria

1. **Given** a GET request to /api/profile
   **When** user is authenticated
   **Then** their profile is returned

2. **Given** a PUT request with profile data
   **When** user is authenticated
   **Then** their profile is updated
   **And** updated profile is returned

3. **Given** a POST request to /api/profile
   **When** user is authenticated and has no profile
   **Then** a new profile is created

4. **Given** profile update includes skills or interests
   **When** the update is saved
   **Then** embedding is regenerated

## Tasks / Subtasks

- [ ] Task 1: Create GET /api/profile (AC: #1)
  - [ ] Create `src/app/api/profile/route.ts`
  - [ ] Get user from session
  - [ ] Query profiles table
  - [ ] Return profile or 404

- [ ] Task 2: Create PUT /api/profile (AC: #2, #4)
  - [ ] Accept profile fields in body
  - [ ] Update profiles table
  - [ ] Trigger embedding regeneration if needed
  - [ ] Return updated profile

- [ ] Task 3: Create POST /api/profile (AC: #3)
  - [ ] Create new profile for user
  - [ ] Handle duplicate (upsert)
  - [ ] Return created profile

## Dev Notes

- RLS policies ensure users can only access their own profile
- Embedding regeneration can be async
- Consider partial updates (PATCH) vs full updates (PUT)

### API Specification

```typescript
// GET /api/profile
// Response 200
{
  id: string;
  user_id: string;
  full_name: string;
  skills: string[];
  experience_level: string;
  availability_hours: number;
  interests: string[];
  collaboration_style: string;
  // ... other fields
}

// PUT /api/profile
// Request
{
  skills?: string[];
  experience_level?: string;
  // ... partial update fields
}

// POST /api/profile
// Request
{
  skills: string[];
  experience_level: string;
  // ... all required fields
}
```

### References

- [Source: planning-artifacts/architecture.md#API Routes Specification]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
