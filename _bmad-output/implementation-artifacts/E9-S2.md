# Story 9.2: Implement ElevenLabs TTS Service

**Epic:** E9 - Voice Agent (POST-MVP)  
**Status:** post-mvp  
**Priority:** P2  
**Dependencies:** API key (ELEVENLABS_API_KEY)  
**Blocks:** 9.3, 9.5

## Story

As a developer,
I want a text-to-speech service using ElevenLabs,
so that the voice agent can speak to users.

## Acceptance Criteria

1. **Given** text to speak
   **When** I call synthesizeSpeech()
   **Then** I get an audio stream/file

2. **Given** the generated audio
   **When** I play it
   **Then** it sounds natural and conversational

3. **Given** API errors
   **When** synthesis fails
   **Then** errors are handled gracefully

## Tasks / Subtasks

- [ ] Task 1: Create ElevenLabs client
  - [ ] Create `src/lib/voice/elevenlabs.ts`
  - [ ] Configure with API key
  - [ ] Select appropriate voice

- [ ] Task 2: Create synthesis function
  - [ ] Implement synthesizeSpeech
  - [ ] Return audio as stream or blob
  - [ ] Handle streaming for long text

- [ ] Task 3: Create API route
  - [ ] Create POST /api/voice/synthesize
  - [ ] Accept text in body
  - [ ] Return audio stream

## Dev Notes

- ElevenLabs has various voice options
- Consider caching common phrases
- Use streaming for real-time playback

### Code Structure

```typescript
// src/lib/voice/elevenlabs.ts
export async function synthesizeSpeech(
  text: string,
  voiceId?: string
): Promise<ArrayBuffer>
```

### References

- [Source: planning-artifacts/architecture.md#Voice Integration]
- ElevenLabs API documentation

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
