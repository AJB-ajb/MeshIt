# Story 1.15: Set Up Playwright for E2E Testing

**Epic:** E1 - Foundation  
**Status:** ready-for-dev  
**Priority:** P2  
**Dependencies:** E1-S1 (Next.js Project), E1-S10 (Auth Flow)  
**Blocks:** E2E tests

## Story

As a developer,
I want Playwright configured for end-to-end testing,
so that I can test complete user flows across the application.

## Acceptance Criteria

1. **Given** the project
   **When** I run `pnpm test:e2e`
   **Then** Playwright runs all E2E test files

2. **Given** an E2E test
   **When** it runs
   **Then** it can interact with the running Next.js app
   **And** it can navigate pages
   **And** it can fill forms and click buttons

3. **Given** tests requiring authentication
   **When** they run
   **Then** auth state can be set up via fixtures

4. **Given** a test failure
   **When** it occurs
   **Then** screenshot and trace are captured for debugging

5. **Given** CI/CD pipeline
   **When** E2E tests run
   **Then** they run in headless mode
   **And** exit code reflects pass/fail status

## Tasks / Subtasks

- [ ] Task 1: Install Playwright (AC: #1)
  - [ ] Run `pnpm create playwright`
  - [ ] Select TypeScript
  - [ ] Install browsers

- [ ] Task 2: Configure Playwright (AC: #2, #4, #5)
  - [ ] Update `playwright.config.ts`
  - [ ] Set base URL to localhost:3000
  - [ ] Configure screenshot on failure
  - [ ] Configure trace on failure
  - [ ] Configure headless mode for CI

- [ ] Task 3: Create auth fixture (AC: #3)
  - [ ] Create `tests/fixtures/auth.ts`
  - [ ] Implement login helper
  - [ ] Save auth state to file for reuse

- [ ] Task 4: Create example E2E test (AC: #2)
  - [ ] Create `tests/e2e/home.spec.ts`
  - [ ] Test landing page loads
  - [ ] Test navigation works

- [ ] Task 5: Add npm scripts (AC: #1, #5)
  - [ ] Add `"test:e2e": "playwright test"`
  - [ ] Add `"test:e2e:ui": "playwright test --ui"`
  - [ ] Add `"test:e2e:debug": "playwright test --debug"`

## Dev Notes

### playwright.config.ts

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
  webServer: {
    command: 'pnpm dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

### Auth Fixture

```typescript
// tests/fixtures/auth.ts
import { test as base, Page } from '@playwright/test';

export const test = base.extend<{ authenticatedPage: Page }>({
  authenticatedPage: async ({ page }, use) => {
    // Set up auth state
    await page.goto('/login');
    // ... login flow
    await use(page);
  },
});
```

### Example E2E Test

```typescript
// tests/e2e/home.spec.ts
import { test, expect } from '@playwright/test';

test('landing page loads', async ({ page }) => {
  await page.goto('/');
  await expect(page).toHaveTitle(/MeshIt/);
  await expect(page.getByRole('heading', { name: /find your/i })).toBeVisible();
});

test('can navigate to login', async ({ page }) => {
  await page.goto('/');
  await page.click('text=Sign In');
  await expect(page).toHaveURL('/login');
});
```

### Package.json Scripts

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug"
  }
}
```

### References

- [Source: planning-artifacts/prd.md#7.1 Tech Stack - Testing]
- [Source: planning-artifacts/architecture.md#Tech Stack]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

