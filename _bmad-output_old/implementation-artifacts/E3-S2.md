# Story 3.2: Implement OpenAI Embedding Service

**Epic:** E3 - Profile Management  
**Status:** ready-for-dev  
**Priority:** P0  
**Dependencies:** API key only (OPENAI_API_KEY)  
**Blocks:** 3.7, E4-S6

## Story

As a developer,
I want an OpenAI service that generates embedding vectors,
so that profiles and projects can be matched semantically.

## Acceptance Criteria

1. **Given** a structured profile object
   **When** I call generateProfileEmbedding()
   **Then** I get a 1536-dimension vector (text-embedding-3-small)

2. **Given** a project description
   **When** I call generateProjectEmbedding()
   **Then** I get a 1536-dimension vector

3. **Given** API rate limits or errors
   **When** embedding generation fails
   **Then** the error is logged
   **And** a meaningful error is returned

4. **Given** the embedding API call (NFR)
   **When** it completes successfully
   **Then** response time is under 5 seconds

## Tasks / Subtasks

- [ ] Task 1: Set up OpenAI client (AC: #1)
  - [ ] Install `openai` package
  - [ ] Create `src/lib/ai/openai.ts`
  - [ ] Configure with API key

- [ ] Task 2: Create embedding functions (AC: #1, #2)
  - [ ] Create `src/lib/ai/embeddings.ts`
  - [ ] Implement generateProfileEmbedding
  - [ ] Implement generateProjectEmbedding
  - [ ] Create text serialization for structured data

- [ ] Task 3: Add error handling (AC: #3)
  - [ ] Handle rate limits
  - [ ] Handle API errors
  - [ ] Log errors for debugging

## Dev Notes

- Use text-embedding-3-small model (1536 dimensions)
- Serialize structured profile to text before embedding
- pgvector stores vectors as arrays

### Code Structure

```typescript
// src/lib/ai/embeddings.ts
export async function generateProfileEmbedding(
  profile: StructuredProfile
): Promise<number[]>

export async function generateProjectEmbedding(
  project: { title: string; description: string; skills_needed: string[] }
): Promise<number[]>

// Helper to serialize profile for embedding
function serializeProfileForEmbedding(profile: StructuredProfile): string
```

### References

- [Source: planning-artifacts/architecture.md#Embedding Generation]
- [Source: planning-artifacts/architecture.md#text-embedding-3-small]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
