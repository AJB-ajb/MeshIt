# Story 3.1: Implement Gemini Extraction Service

**Epic:** E3 - Profile Management  
**Status:** ready-for-dev  
**Priority:** P0  
**Dependencies:** API key only (GOOGLE_AI_API_KEY)  
**Blocks:** 3.3, E4-S1

## Story

As a developer,
I want a Gemini service that extracts structured data from text,
so that I can parse natural language profile descriptions.

## Acceptance Criteria

1. **Given** a text description like "I'm a backend dev with 3 years Python..."
   **When** I call extractProfile()
   **Then** I get structured JSON with skills, experience_level, availability_hours, interests, collaboration_style

2. **Given** incomplete information in the text
   **When** I call extractProfile()
   **Then** reasonable defaults are used for missing fields
   **And** the extraction doesn't fail

3. **Given** an edge case or malformed input
   **When** I call extractProfile()
   **Then** the service returns a valid structure
   **And** errors are handled gracefully

## Tasks / Subtasks

- [ ] Task 1: Set up LangChain with Gemini (AC: #1)
  - [ ] Install `@langchain/google-genai`
  - [ ] Create `src/lib/ai/gemini.ts`
  - [ ] Configure Gemini 2.0 Flash model
  - [ ] Set up environment variable

- [ ] Task 2: Create extraction prompts (AC: #1, #2)
  - [ ] Create `src/lib/ai/prompts/profile-extraction.ts`
  - [ ] Define structured output schema with Zod
  - [ ] Write extraction prompt template

- [ ] Task 3: Implement extraction function (AC: #1, #2, #3)
  - [ ] Create `src/lib/ai/extraction.ts`
  - [ ] Use StructuredOutputParser from LangChain
  - [ ] Handle parsing errors
  - [ ] Add fallback defaults

## Dev Notes

- Use Gemini 2.0 Flash for cost efficiency
- LangChain's StructuredOutputParser ensures valid JSON
- Temperature 0 for consistent extraction

### Code Structure

```typescript
// src/lib/ai/types.ts
export interface StructuredProfile {
  skills: string[];
  experience_level: 'beginner' | 'intermediate' | 'advanced';
  availability_hours: number;
  interests: string[];
  collaboration_style: 'sync' | 'async' | 'flexible';
}

// src/lib/ai/extraction.ts
export async function extractProfile(description: string): Promise<StructuredProfile>
```

### References

- [Source: planning-artifacts/architecture.md#5. AI Service Interface]
- [Source: planning-artifacts/architecture.md#LangChain.js Implementation]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
