# Story 2.6: Add GitHub Sync on OAuth Callback

**Epic:** E2 - GitHub Enrichment  
**Status:** ready-for-dev  
**Priority:** P1  
**Dependencies:** 2.4, 2.5, E1-S10  
**Blocks:** None

## Story

As a user,
I want my GitHub profile auto-extracted on first login,
so that my profile is pre-filled with my coding skills.

## Acceptance Criteria

1. **Given** I log in with GitHub for the first time
   **When** the OAuth callback completes
   **Then** my repos are fetched and analyzed automatically
   **And** my github_profiles record is created

2. **Given** GitHub extraction completes
   **When** I view my profile
   **Then** my skills include languages from GitHub
   **And** my experience level considers GitHub activity

3. **Given** I log in with GitHub again
   **When** the callback processes
   **Then** my GitHub data is refreshed if >24 hours old
   **And** my profile is re-merged

4. **Given** GitHub API fails
   **When** the callback processes
   **Then** login still succeeds
   **And** error is logged for debugging

## Tasks / Subtasks

- [ ] Task 1: Modify auth callback (AC: #1, #4)
  - [ ] Update `src/app/auth/callback/route.ts`
  - [ ] Detect GitHub provider from session
  - [ ] Trigger GitHub extraction for GitHub logins
  - [ ] Handle errors gracefully

- [ ] Task 2: Implement sync logic (AC: #2, #3)
  - [ ] Check if github_profiles exists
  - [ ] Check last_synced_at for refresh logic
  - [ ] Call extraction and save pipeline

- [ ] Task 3: Trigger profile merge (AC: #2)
  - [ ] After GitHub save, merge with existing profile
  - [ ] Update profiles table with merged data
  - [ ] Regenerate embedding if profile changed

## Dev Notes

- Don't block login on GitHub extraction - run async if possible
- Use try/catch to prevent extraction errors from breaking login
- Consider background job for extraction if it's slow

### Code Flow

```
OAuth Callback
    ↓
Check if GitHub provider
    ↓
Get access token from session
    ↓
Call extractGitHubData()
    ↓
Call saveGitHubProfile()
    ↓
Call mergeProfiles()
    ↓
Update profiles table
    ↓
Redirect to onboarding/dashboard
```

### References

- [Source: planning-artifacts/architecture.md#GitHub Profile Enrichment]
- [Source: planning-artifacts/prd.md#GitHub Profile Enrichment]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
