# Story 6.1: Set Up Supabase Realtime

**Epic:** E6 - Notifications  
**Status:** ready-for-dev  
**Priority:** P1  
**Dependencies:** E1-S4 (DB schema with notifications table)  
**Blocks:** 6.2

## Story

As a developer,
I want Supabase Realtime configured for notifications,
so that users receive instant updates.

## Acceptance Criteria

1. **Given** the Supabase project
   **When** I enable Realtime on the notifications table
   **Then** INSERT events are broadcast to subscribers

2. **Given** a client subscribing to notifications
   **When** a new notification is inserted
   **Then** the client receives the event in real-time

3. **Given** RLS policies
   **When** notifications are broadcast
   **Then** users only receive their own notifications

## Tasks / Subtasks

- [ ] Task 1: Enable Realtime on notifications table (AC: #1)
  - [ ] Go to Supabase Dashboard → Database → Replication
  - [ ] Enable Realtime for notifications table
  - [ ] Configure to broadcast INSERTs

- [ ] Task 2: Create Realtime client helper (AC: #2)
  - [ ] Create `src/lib/supabase/realtime.ts`
  - [ ] Implement subscribeToNotifications function
  - [ ] Handle connection lifecycle

- [ ] Task 3: Verify RLS with Realtime (AC: #3)
  - [ ] Test that users only receive their own notifications
  - [ ] Verify filter by user_id works

## Dev Notes

- Supabase Realtime uses WebSockets
- RLS policies are respected for Realtime
- Consider reconnection logic for dropped connections

### Code Structure

```typescript
// src/lib/supabase/realtime.ts
export function subscribeToNotifications(
  userId: string,
  onNotification: (notification: Notification) => void
): RealtimeChannel

// Usage
const channel = subscribeToNotifications(userId, (notif) => {
  console.log('New notification:', notif);
});

// Cleanup
channel.unsubscribe();
```

### References

- [Source: planning-artifacts/architecture.md#Real-time Notifications]
- Supabase Realtime documentation

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
