# Story 1.14: Set Up Vitest for Unit Testing

**Epic:** E1 - Foundation  
**Status:** ready-for-dev  
**Priority:** P1  
**Dependencies:** E1-S1 (Next.js Project)  
**Blocks:** All unit tests

## Story

As a developer,
I want Vitest configured for unit testing,
so that I can write and run tests for utilities, services, and components.

## Acceptance Criteria

1. **Given** the project
   **When** I run `pnpm test`
   **Then** Vitest runs all test files

2. **Given** a test file in `__tests__/` or `*.test.ts`
   **When** I run tests
   **Then** the test is discovered and executed

3. **Given** the test setup
   **When** I run tests
   **Then** TypeScript is supported
   **And** path aliases work (@/*)
   **And** React components can be tested

4. **Given** a test run
   **When** it completes
   **Then** coverage report is generated (optional flag)

5. **Given** CI/CD pipeline
   **When** tests run
   **Then** exit code reflects pass/fail status

## Tasks / Subtasks

- [ ] Task 1: Install Vitest and dependencies (AC: #1, #3)
  - [ ] Run `pnpm add -D vitest @vitejs/plugin-react jsdom @testing-library/react @testing-library/jest-dom`
  - [ ] Add test scripts to package.json

- [ ] Task 2: Configure Vitest (AC: #2, #3, #4)
  - [ ] Create `vitest.config.ts`
  - [ ] Configure TypeScript support
  - [ ] Configure path aliases
  - [ ] Configure jsdom environment for React
  - [ ] Configure coverage (v8 or istanbul)

- [ ] Task 3: Create test setup file (AC: #3)
  - [ ] Create `src/test/setup.ts`
  - [ ] Import @testing-library/jest-dom matchers
  - [ ] Add any global test utilities

- [ ] Task 4: Create example tests (AC: #1, #2)
  - [ ] Create `src/lib/utils/__tests__/example.test.ts`
  - [ ] Write simple passing test
  - [ ] Verify test discovery works

- [ ] Task 5: Add npm scripts (AC: #1, #4, #5)
  - [ ] Add `"test": "vitest"`
  - [ ] Add `"test:run": "vitest run"`
  - [ ] Add `"test:coverage": "vitest run --coverage"`

## Dev Notes

### vitest.config.ts

```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./src/test/setup.ts'],
    include: ['**/*.{test,spec}.{js,ts,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### Test Setup File

```typescript
// src/test/setup.ts
import '@testing-library/jest-dom';
```

### Example Test

```typescript
// src/lib/utils/__tests__/example.test.ts
import { describe, it, expect } from 'vitest';

describe('Example', () => {
  it('should pass', () => {
    expect(1 + 1).toBe(2);
  });
});
```

### Package.json Scripts

```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run",
    "test:coverage": "vitest run --coverage"
  }
}
```

### References

- [Source: planning-artifacts/prd.md#7.1 Tech Stack - Testing]
- [Source: planning-artifacts/architecture.md#Tech Stack]

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

