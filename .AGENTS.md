# .AGENTS.md

AI agent instructions for the MeshIt codebase.

## Quick Reference

- **Stack**: Next.js 16, React 19, TypeScript (strict), Tailwind CSS 4, Supabase, shadcn/ui
- **Package Manager**: pnpm (required, enforced)
- **Dev Server**: `pnpm dev`
- **Lint**: `pnpm lint`
- **Tests**: `pnpm test` (unit, watch), `pnpm test:run` (unit, once), `pnpm test:e2e` (E2E)
- **Type Check**: `pnpm tsc --noEmit`
- **Build**: `pnpm build`
- **Add UI Components**: `pnpm dlx shadcn@latest add [component]`

## Conventions

- Follow conventional commit format: `type(scope): description` (e.g. `feat(matching): add location filter`)
- Pre-commit hook runs Prettier + ESLint on staged files via lint-staged
- Branch naming: `feat/`, `fix/`, `chore/`, `refactor/`, `docs/`, `test/` prefixes
- See `CONTRIBUTING.md` for full team conventions
- If the work contains planning, update specs in `spec/`

## Git Workflow

- Never work directly on `main` or `dev` — always use a feature/fix branch
- If your work doesn't match the current branch's theme, create a new feature branch
- Commit and push freely when on your own feature/fix branch
- Only open a PR (target: `dev`) when work is complete and tests pass

## Worktrees

- `.env` is not present in new worktrees — copy from main repo: `cp ../MeshIt/.env .env`
- Shell cwd may reset to the main repo after commands — use absolute paths or verify cwd

## Build Requirements

### Environment

Ensure `.env` (or `.env.local`) exists before running tests or dev server.

### Pre-Deployment Testing

Always run `pnpm build` before deploying to catch build-time errors.

### Suspense Boundaries

- `useSearchParams()` must be wrapped in `<Suspense>` to avoid build errors
- Extract component using `useSearchParams()` into separate component, wrap default export with Suspense

## Supabase CLI

```bash
# Link to project (one-time setup)
supabase link --project-ref YOUR_PROJECT_REF

# Create migration
supabase migration new migration_name

# Apply migrations to remote database
supabase db push

# Check migration status
supabase migration list

# Pull remote schema changes
supabase db pull
```

When updating database model, update `docs/DATA_MODEL.md`.

## Key Directories

- `src/app/` - Next.js App Router pages and API routes
- `src/components/` - React components (layout, ui, match, project, profile)
- `src/lib/` - Utilities (supabase, matching, ai, hooks, types)
- `spec/` - Product specifications
- `docs/` - Technical documentation
- `tests/` - E2E and integration tests
- `supabase/migrations/` - SQL migration files
